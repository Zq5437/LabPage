# 🚀 网站上线检查清单

## ✅ 部署前检查

### 1. 环境准备
- [ ] Node.js 已安装 (16.0+)
- [ ] MySQL 已安装并运行
- [ ] Nginx 已安装
- [ ] Cpolar 已安装并有账号
- [ ] Apache 已停止（避免端口冲突）

**检查命令：**
```bash
node -v          # 应显示 v16.0.0 或更高
mysql --version  # 应显示 8.0 或更高
nginx -v         # 应显示版本号
cpolar version   # 应显示版本号
sudo lsof -i :80 # 确保80端口未被占用
```

### 2. 数据库配置
- [ ] MySQL 服务已启动
- [ ] 数据库 `lab_website` 已创建
- [ ] 数据库表结构已导入
- [ ] 默认管理员账号已创建

**执行命令：**
```bash
# 启动 MySQL
brew services start mysql

# 导入数据库
mysql -u root -p < database/schema.sql

# 验证数据库
mysql -u root -p -e "USE lab_website; SHOW TABLES;"
```

### 3. 后端配置
- [ ] `backend/.env` 文件已创建
- [ ] 数据库密码已正确配置
- [ ] JWT_SECRET 已设置为随机字符串
- [ ] uploads 目录有写入权限

**检查 backend/.env：**
```bash
cd backend
cat .env  # 确认配置正确

# 如果没有 .env 文件，从示例复制
cp config.example.js config.js
```

### 4. 前端构建
- [ ] 前端依赖已安装
- [ ] 前端已成功构建
- [ ] `frontend/dist` 目录存在且有文件

**构建命令：**
```bash
cd frontend
npm install
npm run build
ls -la dist  # 确认有 index.html 等文件
```

### 5. 管理后台构建
- [ ] 管理后台依赖已安装
- [ ] 管理后台已成功构建
- [ ] `admin/dist` 目录存在且有文件
- [ ] vite.config.js 中 base 设置为 '/admin/'

**构建命令：**
```bash
cd admin
npm install
npm run build
ls -la dist  # 确认有 index.html 等文件
```

## 🔧 Nginx 配置检查

### 配置文件检查
- [ ] Nginx 配置文件已正确修改
- [ ] 监听端口为 80
- [ ] 前端路径指向正确
- [ ] 管理后台路径指向正确
- [ ] API 反向代理配置正确
- [ ] uploads 目录配置正确

**测试配置：**
```bash
# 测试 nginx 配置
sudo nginx -t

# 应显示：
# nginx: the configuration file /opt/homebrew/etc/nginx/nginx.conf syntax is ok
# nginx: configuration file /opt/homebrew/etc/nginx/nginx.conf test is successful
```

### 路径确认
检查 nginx.conf 中的路径是否正确：
```
前端: /Users/zhangqi/Desktop/实验室建站/2框架测试/LabPage/frontend/dist
管理: /Users/zhangqi/Desktop/实验室建站/2框架测试/LabPage/admin/dist
上传: /Users/zhangqi/Desktop/实验室建站/2框架测试/LabPage/backend/uploads/
```

## 🎯 部署步骤

### 自动部署（推荐）
```bash
# 运行部署脚本
./deploy.sh
```

### 手动部署
```bash
# 1. 构建前端
cd frontend && npm install && npm run build

# 2. 构建管理后台
cd ../admin && npm install && npm run build

# 3. 安装后端依赖
cd ../backend && npm install

# 4. 启动后端（推荐使用 PM2）
npm install -g pm2
pm2 start server.js --name LabPage_backend
pm2 save

# 5. 启动 Nginx
sudo nginx -t
sudo brew services restart nginx
```

## 🌐 服务验证

### 1. 后端服务检查
- [ ] 后端运行在 5080 端口
- [ ] API 可以访问

**检查命令：**
```bash
# 检查端口
lsof -i :5080

# 测试 API
curl http://localhost:5080/public/lab-info

# 查看后端日志（如果使用 PM2）
pm2 logs LabPage_backend
```

### 2. Nginx 服务检查
- [ ] Nginx 运行在 80 端口
- [ ] Nginx 服务状态正常

**检查命令：**
```bash
# 检查 Nginx 状态
sudo brew services list | grep nginx

# 检查端口
sudo lsof -i :80

# 查看 Nginx 日志
tail -f /opt/homebrew/var/log/nginx/lab_website.access.log
tail -f /opt/homebrew/var/log/nginx/lab_website.error.log
```

### 3. 网站访问测试
- [ ] 前端首页可访问：http://localhost
- [ ] 管理后台可访问：http://localhost/admin
- [ ] API 可访问：http://localhost/api/public/lab-info
- [ ] 静态资源加载正常
- [ ] 图片上传功能正常

**浏览器测试：**
```bash
# 打开浏览器测试
open http://localhost
open http://localhost/admin
```

## 🔌 Cpolar 穿透配置

### 1. Cpolar 基础配置
- [ ] Cpolar 已安装
- [ ] Authtoken 已配置
- [ ] 固定域名已申请（可选）

**配置命令：**
```bash
# 设置 authtoken
cpolar authtoken 你的token

# 测试穿透
cpolar http 80
```

### 2. 固定域名配置（推荐）
- [ ] 配置文件已创建
- [ ] 隧道配置已添加
- [ ] 固定域名已设置

**配置文件位置：**
```bash
vim ~/.cpolar/cpolar.yml
```

### 3. 公网访问测试
- [ ] Cpolar 隧道已启动
- [ ] 可以通过公网地址访问
- [ ] HTTPS 访问正常
- [ ] 管理后台可通过公网访问

## 🔒 安全检查

### 1. 账号安全
- [ ] 已修改默认管理员密码
- [ ] JWT_SECRET 使用了强密码
- [ ] 数据库密码足够复杂

### 2. 文件权限
- [ ] uploads 目录权限正确
- [ ] 配置文件权限安全（.env 不能被公网访问）

### 3. 防火墙设置
- [ ] 只开放必要端口（80, 443）
- [ ] 5080 端口不对外暴露

## 📊 功能测试

### 前端功能
- [ ] 首页正常显示
- [ ] 新闻列表加载正常
- [ ] 成员页面显示正常
- [ ] 项目页面显示正常
- [ ] 论文页面显示正常
- [ ] 联系表单可以提交

### 管理后台功能
- [ ] 登录功能正常
- [ ] 仪表盘数据显示正常
- [ ] 可以添加/编辑新闻
- [ ] 可以添加/编辑成员
- [ ] 可以上传图片
- [ ] 图片显示正常

## 📝 性能优化（可选）

- [ ] 启用 Nginx Gzip 压缩
- [ ] 配置静态资源缓存
- [ ] 使用 PM2 集群模式
- [ ] 配置数据库索引
- [ ] 设置日志轮转

**Gzip 配置：**
在 nginx.conf 中取消注释：
```nginx
gzip on;
gzip_types text/plain text/css application/json application/javascript;
```

## 🔄 备份配置

### 定期备份
- [ ] 设置数据库自动备份
- [ ] 备份 uploads 目录
- [ ] 备份配置文件

**备份脚本示例：**
```bash
# 数据库备份
mysqldump -u root -p lab_website > backup_$(date +%Y%m%d).sql

# 文件备份
tar -czf uploads_backup_$(date +%Y%m%d).tar.gz backend/uploads/
```

## 📞 应急联系

### 常用命令速查

**重启所有服务：**
```bash
pm2 restart LabPage_backend
sudo brew services restart nginx
```

**查看日志：**
```bash
pm2 logs LabPage_backend
tail -f /opt/homebrew/var/log/nginx/lab_website.error.log
```

**停止所有服务：**
```bash
pm2 stop LabPage_backend
sudo brew services stop nginx
```

## ✨ 完成确认

全部检查完成后，确认以下内容：

✅ 网站可以通过 localhost 访问  
✅ 网站可以通过 cpolar 公网地址访问  
✅ 管理后台可以登录  
✅ 可以正常添加/编辑内容  
✅ 图片上传和显示正常  
✅ 所有页面都能正常访问  
✅ 移动端访问正常  

---

**恭喜！🎉 你的实验室网站已成功上线！**

如有问题，请查看：
- `部署指南.md` - 详细部署说明
- `cpolar配置说明.md` - Cpolar 使用指南
- `/opt/homebrew/var/log/nginx/` - Nginx 日志
- `pm2 logs` - 后端日志

