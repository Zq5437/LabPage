# ⚡ 快速上线指南

> 5分钟快速部署实验室网站到公网

## 📦 你已经有的
- ✅ Mac 电脑
- ✅ Nginx 已安装
- ✅ Cpolar 已安装并有固定地址
- ✅ MySQL 已安装
- ✅ Node.js 已安装

## 🚀 三步上线

### 第一步：准备数据库（1分钟）

```bash
# 1. 启动 MySQL
brew services start mysql

# 2. 导入数据库
cd /Users/zhangqi/Desktop/实验室建站/2框架测试/LabPage
mysql -u root -p < database/schema.sql
# 输入你的 MySQL 密码

# 3. 配置后端环境变量
cd backend
# 确认 .env 文件存在，修改数据库密码
nano .env  # 或用任何编辑器打开
```

### 第二步：一键部署（2分钟）

```bash
# 返回项目根目录
cd /Users/zhangqi/Desktop/实验室建站/2框架测试/LabPage

# 运行部署脚本
./deploy.sh
```

脚本会自动：
- ✅ 构建前端和管理后台
- ✅ 安装后端依赖
- ✅ 启动后端服务（使用 PM2）
- ✅ 重启 Nginx

### 第三步：配置公网访问（2分钟）

```bash
# 方式1：使用临时地址（快速测试）
cpolar http 80

# 方式2：使用固定域名（推荐）
cpolar http -subdomain=你的固定域名 80
```

## ✨ 完成！

现在你可以访问：

**本地访问：**
- 前端网站：http://localhost
- 管理后台：http://localhost/admin

**公网访问：**
- 前端网站：http://你的域名.cpolar.cn
- 管理后台：http://你的域名.cpolar.cn/admin

**默认管理员账号：**
- 用户名：`admin`
- 密码：`admin123`

⚠️ **重要：首次登录后立即修改密码！**

---

## 🔧 常用命令

```bash
# 重启所有服务
pm2 restart LabPage_backend && sudo brew services restart nginx

# 查看服务状态
pm2 status                      # 查看后端
sudo brew services list         # 查看 nginx

# 查看日志
pm2 logs LabPage_backend           # 后端日志
tail -f /opt/homebrew/var/log/nginx/lab_website.error.log  # nginx日志

# 停止服务
pm2 stop LabPage_backend
sudo brew services stop nginx
```

## 📚 详细文档

遇到问题？查看详细文档：
- `部署指南.md` - 完整部署步骤
- `cpolar配置说明.md` - Cpolar 详细配置
- `上线检查清单.md` - 完整检查清单

## ❓ 常见问题

**Q: 80端口被占用怎么办？**
```bash
# 停止 Apache（如果在运行）
sudo apachectl stop

# 查看谁在占用80端口
sudo lsof -i :80
```

**Q: 后端启动失败？**
```bash
# 检查 .env 配置是否正确
cd backend && cat .env

# 检查数据库是否启动
brew services list | grep mysql
```

**Q: Nginx 配置错误？**
```bash
# 测试配置
sudo nginx -t

# 查看错误日志
tail -20 /opt/homebrew/var/log/nginx/lab_website.error.log
```

**Q: 网站能本地访问但公网无法访问？**
- 确认 cpolar 正在运行
- 访问 http://localhost:9200 查看 cpolar 状态
- 检查防火墙设置

---

## 💡 小贴士

1. **后台运行 cpolar：**
   ```bash
   nohup cpolar http 80 > cpolar.log 2>&1 &
   ```

2. **设置开机自启：**
   - Nginx: 已通过 brew services 自动配置
   - PM2: `pm2 startup` 然后 `pm2 save`

3. **定期备份数据库：**
   ```bash
   mysqldump -u root -p lab_website > backup.sql
   ```

4. **监控网站状态：**
   - Cpolar Web界面: http://localhost:9200
   - PM2 监控: `pm2 monit`

---

🎉 **祝你的实验室网站顺利上线！**

